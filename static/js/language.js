// Comprehensive Translation Dictionary
const translations = {
  en: {
    // Header & Navigation
    header_title: "AI-POWERED DETECTION OF DISEASE IN PECHAY LEAVES",
    dashboard: "ðŸ“Š Dashboard",
    scan_leaf: "ðŸ“¸ Scan Leaf",
    results: "ðŸ“ Results",
    analytics: "ðŸ“ˆ Analytics",
    settings: "âš™ï¸ Settings",
    logout: "ðŸšª Logout",
    
    // Login Page
    login_title: "Log In",
    username: "Username",
    password: "Password",
    login_button: "Login",
    splash_text: "AI-POWERED DETECTION OF DISEASE IN PECHAY LEAVES",
    
    // Dashboard
    dashboard_overview: "ðŸ“Š Dashboard Overview",
    total_scans: "Total Scans",
    healthy_leaves: "Healthy Leaves",
    diseased_leaves: "Diseased Leaves",
    success_rate: "Success Rate",
    welcome_message: "ðŸŒ± Welcome to Pechay Detection System!",
    no_scans_message: "No scans yet. Upload your first pechay leaf image to get started with detection.",
    recent_activity: "ðŸ“ˆ Recent Activity",
    processed_images: "You have processed",
    leaf_images: "leaf images.",
    health_distribution: "Health Distribution:",
    healthy_percent: "healthy",
    diseased_percent: "diseased",
    create_dataset: "âž• Create Petchay Dataset",
    upload_new_image: "ðŸ“· Upload New Image",
    view_results: "ðŸ“ View Results",
    
    // Upload Page
    scan_pechay_leaf: "ðŸ“¸ Scan Petchay Leaf",
    upload_description: "Upload a pechay leaf image to detect disease condition.",
    detection_result: "Detection Result",
    leaf_condition_analysis: "Leaf condition analysis complete",
    status: "Status",
    disease: "Disease",
    confidence: "Confidence",
    treatment: "Treatment",
    scanned_image: "Scanned Image",
    not_pechay_leaf: "Not Pechay Leaf",
    uploaded_not_pechay: "Uploaded image is not a pechay leaf",
    leaf_is_healthy: "Leaf is healthy",
    disease_detected: "Disease detected",
    
    // Results Page
    detection_results: "ðŸ“ Detection Results",
    filter_by_time: "ðŸ“… Filter by time range:",
    all_time: "All Time",
    last_24_hours: "Last 24 Hours",
    last_7_days: "Last 7 Days",
    last_21_days: "Last 21 Days",
    status_filter: "Status:",
    all: "All",
    healthy_only: "Healthy Only",
    diseased_only: "Diseased Only",
    not_pechay_only: "Not Pechay Only",
    showing_filter: "Showing:",
    leaves_only: "leaves only",
    clear_filter: "âœ• Clear Filter",
    recent_detection_results: "Recent leaf detection results and analysis.",
    no_results_found: "No detection results found. Upload some images first!",
    no_filtered_results: "No",
    leaves_found: "leaves found. Try removing the filter or upload new images.",
    date: "Date:",
    
    // Analytics Page
    analytics_reports: "ðŸ“ˆ Analytics & Reports",
    last_7_days_activity: "Last 7 Days Activity",
    health_distribution_chart: "Health Distribution",
    confidence_distribution: "Confidence Level Distribution",
    generate_report: "ðŸ“„ Generate Report",
    customize_download: "Customize and download a printable report of your detection history.",
    condition: "Condition:",
    all_conditions: "All Conditions",
    healthy_only_option: "Healthy Only",
    diseased_only_option: "Diseased Only",
    time_range: "Time Range:",
    all_time_option: "All Time",
    last_24_hours_option: "Last 24 Hours",
    last_7_days_option: "Last 7 Days",
    last_30_days: "Last 30 Days",
    custom_range: "Custom Range",
    start_date: "Start Date:",
    end_date: "End Date:",
    generate_view_report: "ðŸ–¨ï¸ Generate & View Report",
    failed_load_analytics: "Failed to load analytics data. Please try again.",
    
    // Settings Page
    language_settings: "ðŸŒ Language Settings",
    select_language: "Select Language:",
    profile_settings: "ðŸ‘¤ Profile Settings",
    username_label: "Username:",
    username_immutable: "Username cannot be changed",
    email_label: "Email:",
    update_profile: "ðŸ’¾ Update Profile",
    change_password: "ðŸ”’ Change Password",
    current_password: "Current Password:",
    new_password: "New Password:",
    min_chars: "Minimum 4 characters",
    confirm_new_password: "Confirm New Password:",
    change_password_btn: "ðŸ”‘ Change Password",
    session_management: "ðŸšª Session Management",
    sign_out_desc: "Sign out of your account. You can log back in anytime.",
    logout_button: "ðŸšª Logout",
    
    // Camera/Stream
    esp32_cam_live_view: "ðŸ“¹ ESP32-CAM Live View",
    enter_ip_address: "Enter ESP32-CAM IP address and click \"Start Stream\" or \"Start Polling\"",
    camera_ip_placeholder: "ESP32-CAM IP (e.g., 192.168.1.100)",
    start_stream: "â–¶ï¸ Start Stream",
    stop: "â¹ï¸ Stop",
    camera_live_view: "Camera Live View",
    enter_ip_above: "Enter ESP32-CAM IP address above",
    click_start: "Click \"Start Polling\" or \"Start Stream\" to begin",
    scanning_leaf: "Scanning Leaf",
    analyzing_image: "Analyzing image to detect pechay leaf condition. Please wait a moment.",
    scanning_in_progress: "Scanning in progress",
    
    // Report Page
    pechay_leaf_detection_report: "Pechay Leaf Detection Report",
    generated_by: "Generated By:",
    filters_applied: "Filters Applied:",
    recent_detections: "ðŸ“‹ Recent Detections",
    no_detection_records: "No detection records found.",
    back_to_dashboard: "â¬…ï¸ Back to Dashboard",
    print_report: "ðŸ–¨ï¸ Print Report",
    download_excel: "ðŸ“¥ Download Excel",
    
    // Dataset Manager
    dataset_manager_title: "Dataset Manager - Pechay Detection System",
    feature_disabled_title: "Feature Disabled",
    feature_disabled_msg: "This feature has been disabled."
  },
  tl: {
    // Header & Navigation
    header_title: "AI-POWERED DETECTION NG SAKIT SA DAHON NG PECHAY",
    dashboard: "ðŸ“Š Dashboard",
    scan_leaf: "ðŸ“¸ I-scan ang Dahon",
    results: "ðŸ“ Mga Resulta",
    analytics: "ðŸ“ˆ Analytics",
    settings: "âš™ï¸ Mga Setting",
    logout: "ðŸšª Mag-logout",
    
    // Login Page
    login_title: "Mag-log In",
    username: "Pangalan ng Gumagamit",
    password: "Password",
    login_button: "Mag-login",
    splash_text: "AI-POWERED DETECTION NG SAKIT SA DAHON NG PECHAY",
    
    // Dashboard
    dashboard_overview: "ðŸ“Š Pangkalahatang Dashboard",
    total_scans: "Kabuuang Scan",
    healthy_leaves: "Malusog na Dahon",
    diseased_leaves: "May Sakit na Dahon",
    success_rate: "Rate ng Tagumpay",
    welcome_message: "ðŸŒ± Maligayang Pagdating sa Pechay Detection System!",
    no_scans_message: "Wala pang scan. Mag-upload ng unang larawan ng dahon ng pechay upang magsimula sa detection.",
    recent_activity: "ðŸ“ˆ Kamakailang Aktibidad",
    processed_images: "Nakaproseso ka na ng",
    leaf_images: "na mga larawan ng dahon.",
    health_distribution: "Distribusyon ng Kalusugan:",
    healthy_percent: "malusog",
    diseased_percent: "may sakit",
    create_dataset: "âž• Gumawa ng Petchay Dataset",
    upload_new_image: "ðŸ“· Mag-upload ng Bagong Larawan",
    view_results: "ðŸ“ Tingnan ang Mga Resulta",
    
    // Upload Page
    scan_pechay_leaf: "ðŸ“¸ I-scan ang Petchay Leaf",
    upload_description: "Mag-upload ng larawan ng dahon ng pechay upang matukoy ang kondisyon ng sakit.",
    detection_result: "Resulta ng Detection",
    leaf_condition_analysis: "Kumpleto na ang pagsusuri ng kondisyon ng dahon",
    status: "Status",
    disease: "Sakit",
    confidence: "Kumpiyansa",
    treatment: "Gamot",
    scanned_image: "Naka-scan na Larawan",
    not_pechay_leaf: "Hindi Pechay Leaf",
    uploaded_not_pechay: "Ang na-upload na larawan ay hindi dahon ng pechay",
    leaf_is_healthy: "Malusog ang dahon",
    disease_detected: "Nakita ang sakit",
    
    // Results Page
    detection_results: "ðŸ“ Mga Resulta ng Detection",
    filter_by_time: "ðŸ“… I-filter ayon sa saklaw ng oras:",
    all_time: "Lahat ng Oras",
    last_24_hours: "Huling 24 na Oras",
    last_7_days: "Huling 7 na Araw",
    last_21_days: "Huling 21 na Araw",
    status_filter: "Status:",
    all: "Lahat",
    healthy_only: "Malusog Lamang",
    diseased_only: "May Sakit Lamang",
    not_pechay_only: "Hindi Pechay Lamang",
    showing_filter: "Ipinapakita:",
    leaves_only: "na mga dahon lamang",
    clear_filter: "âœ• Alisin ang Filter",
    recent_detection_results: "Kamakailang mga resulta at pagsusuri ng detection ng dahon.",
    no_results_found: "Walang nakitang resulta ng detection. Mag-upload muna ng mga larawan!",
    no_filtered_results: "Walang",
    leaves_found: "na mga dahon ang nahanap. Subukan na alisin ang filter o mag-upload ng bagong mga larawan.",
    date: "Petsa:",
    
    // Analytics Page
    analytics_reports: "ðŸ“ˆ Analytics at Mga Report",
    last_7_days_activity: "Aktibidad sa Huling 7 na Araw",
    health_distribution_chart: "Distribusyon ng Kalusugan",
    confidence_distribution: "Distribusyon ng Antas ng Kumpiyansa",
    generate_report: "ðŸ“„ Gumawa ng Report",
    customize_download: "I-customize at i-download ang printable report ng iyong detection history.",
    condition: "Kondisyon:",
    all_conditions: "Lahat ng Kondisyon",
    healthy_only_option: "Malusog Lamang",
    diseased_only_option: "May Sakit Lamang",
    time_range: "Saklaw ng Oras:",
    all_time_option: "Lahat ng Oras",
    last_24_hours_option: "Huling 24 na Oras",
    last_7_days_option: "Huling 7 na Araw",
    last_30_days: "Huling 30 na Araw",
    custom_range: "Custom na Saklaw",
    start_date: "Petsa ng Simula:",
    end_date: "Petsa ng Wakas:",
    generate_view_report: "ðŸ–¨ï¸ Gumawa at Tingnan ang Report",
    failed_load_analytics: "Nabigo na i-load ang analytics data. Pakisubukan ulit.",
    
    // Settings Page
    language_settings: "ðŸŒ Mga Setting ng Wika",
    select_language: "Pumili ng Wika:",
    profile_settings: "ðŸ‘¤ Mga Setting ng Profile",
    username_label: "Pangalan ng Gumagamit:",
    username_immutable: "Hindi mapapalitan ang Username",
    email_label: "Email:",
    update_profile: "ðŸ’¾ I-update ang Profile",
    change_password: "ðŸ”’ Palitan ang Password",
    current_password: "Kasalukuyang Password:",
    new_password: "Bagong Password:",
    min_chars: "Minimum na 4 na karakter",
    confirm_new_password: "Kumpirmahin ang Bagong Password:",
    change_password_btn: "ðŸ”‘ Palitan ang Password",
    session_management: "ðŸšª Pamamahala ng Sesyon",
    sign_out_desc: "Mag-sign out sa iyong account. Maaari kang mag-log back in anumang oras.",
    logout_button: "ðŸšª Mag-logout",
    
    // Camera/Stream
    esp32_cam_live_view: "ðŸ“¹ ESP32-CAM Live View",
    enter_ip_address: "Ilagay ang ESP32-CAM IP address at i-click ang \"Start Stream\" o \"Start Polling\"",
    camera_ip_placeholder: "ESP32-CAM IP (hal., 192.168.1.100)",
    start_stream: "â–¶ï¸ Simulan ang Stream",
    stop: "â¹ï¸ Itigil",
    camera_live_view: "Live View ng Camera",
    enter_ip_above: "Ilagay ang ESP32-CAM IP address sa itaas",
    click_start: "I-click ang \"Start Polling\" o \"Start Stream\" upang magsimula",
    scanning_leaf: "Sinusuri ang Dahon",
    analyzing_image: "Sinusuri ang larawan upang matukoy ang kondisyon ng dahon ng pechay. Pakihintay sandali.",
    scanning_in_progress: "Sinusuri",
    
    // Report Page
    pechay_leaf_detection_report: "Report ng Detection ng Dahon ng Pechay",
    generated_by: "Ginawa Ni:",
    filters_applied: "Mga Filter na Inilapat:",
    recent_detections: "ðŸ“‹ Kamakailang Mga Detection",
    no_detection_records: "Walang nakitang record ng detection.",
    back_to_dashboard: "â¬…ï¸ Bumalik sa Dashboard",
    print_report: "ðŸ–¨ï¸ I-print ang Report",
    download_excel: "ðŸ“¥ I-download ang Excel",
    
    // Dataset Manager
    dataset_manager_title: "Tagapamahala ng Dataset - Pechay Detection System",
    feature_disabled_title: "Naka-disable ang Tampok",
    feature_disabled_msg: "Ang tampok na ito ay hindi pinagana."
  },
  war: {
    // Header & Navigation
    header_title: "AI-POWERED DETECTION HAN SAKIT HA DAHON HAN PECHAY",
    dashboard: "ðŸ“Š Dashboard",
    scan_leaf: "ðŸ“¸ I-scan an Dahon",
    results: "ðŸ“ Mga Resulta",
    analytics: "ðŸ“ˆ Analytics",
    settings: "âš™ï¸ Mga Setting",
    logout: "ðŸšª Pag-gawas",
    
    // Login Page
    login_title: "Mag-log In",
    username: "Ngaran han Gumaramit",
    password: "Password",
    login_button: "Mag-login",
    splash_text: "AI-POWERED DETECTION HAN SAKIT HA DAHON HAN PECHAY",
    
    // Dashboard
    dashboard_overview: "ðŸ“Š Pangkalahatan nga Dashboard",
    total_scans: "Bug-os nga Scan",
    healthy_leaves: "Maupay nga Dahon",
    diseased_leaves: "May Sakit nga Dahon",
    success_rate: "Rate han Kalampusan",
    welcome_message: "ðŸŒ± Maupay nga Pag-abot ha Pechay Detection System!",
    no_scans_message: "Waray pa scan. Mag-upload hin unang ladawan han dahon han pechay para magsugod ha detection.",
    recent_activity: "ðŸ“ˆ Kamakailan nga Aktibidad",
    processed_images: "Nakaproseso ka na han",
    leaf_images: "nga mga ladawan han dahon.",
    health_distribution: "Distribusyon han Kalusugan:",
    healthy_percent: "maupay",
    diseased_percent: "may sakit",
    create_dataset: "âž• Maghimo hin Petchay Dataset",
    upload_new_image: "ðŸ“· Mag-upload hin Bag-o nga Ladawan",
    view_results: "ðŸ“ Tan-awa an Mga Resulta",
    
    // Upload Page
    scan_pechay_leaf: "ðŸ“¸ I-scan an Petchay Leaf",
    upload_description: "Mag-upload hin ladawan han dahon han pechay para matukoy an kondisyon han sakit.",
    detection_result: "Resulta han Detection",
    leaf_condition_analysis: "Kumpleto na an pagsusuri han kondisyon han dahon",
    status: "Status",
    disease: "Sakit",
    confidence: "Kumpiyansa",
    treatment: "Gamot",
    scanned_image: "Naka-scan nga Ladawan",
    not_pechay_leaf: "Diri Pechay Leaf",
    uploaded_not_pechay: "An na-upload nga ladawan diri dahon han pechay",
    leaf_is_healthy: "Maupay an dahon",
    disease_detected: "Nakita an sakit",
    
    // Results Page
    detection_results: "ðŸ“ Mga Resulta han Detection",
    filter_by_time: "ðŸ“… I-filter sumala ha saklaw han oras:",
    all_time: "Ngatanan nga Oras",
    last_24_hours: "Kataposan nga 24 ka Oras",
    last_7_days: "Kataposan nga 7 ka Adlaw",
    last_21_days: "Kataposan nga 21 ka Adlaw",
    status_filter: "Status:",
    all: "Ngatanan",
    healthy_only: "Maupay La",
    diseased_only: "May Sakit La",
    not_pechay_only: "Diri Pechay La",
    showing_filter: "Ginpapakita:",
    leaves_only: "nga mga dahon la",
    clear_filter: "âœ• Alisin an Filter",
    recent_detection_results: "Kamakailan nga mga resulta ngan pagsusuri han detection han dahon.",
    no_results_found: "Waray nakitang resulta han detection. Mag-upload muna hin mga ladawan!",
    no_filtered_results: "Waray",
    leaves_found: "nga mga dahon an nakit-an. Subayi na alisin an filter o mag-upload hin bag-o nga mga ladawan.",
    date: "Petsa:",
    
    // Analytics Page
    analytics_reports: "ðŸ“ˆ Analytics ngan Mga Report",
    last_7_days_activity: "Aktibidad ha Kataposan nga 7 ka Adlaw",
    health_distribution_chart: "Distribusyon han Kalusugan",
    confidence_distribution: "Distribusyon han Antas han Kumpiyansa",
    generate_report: "ðŸ“„ Maghimo hin Report",
    customize_download: "I-customize ngan i-download an printable report han imo detection history.",
    condition: "Kondisyon:",
    all_conditions: "Ngatanan nga Kondisyon",
    healthy_only_option: "Maupay La",
    diseased_only_option: "May Sakit La",
    time_range: "Saklaw han Oras:",
    all_time_option: "Ngatanan nga Oras",
    last_24_hours_option: "Kataposan nga 24 ka Oras",
    last_7_days_option: "Kataposan nga 7 ka Adlaw",
    last_30_days: "Kataposan nga 30 ka Adlaw",
    custom_range: "Custom nga Saklaw",
    start_date: "Petsa han Pagsugod:",
    end_date: "Petsa han Kataposan:",
    generate_view_report: "ðŸ–¨ï¸ Maghimo ngan Tan-awa an Report",
    failed_load_analytics: "Nabigo na i-load an analytics data. Pakisubayi liwat.",
    
    // Settings Page
    language_settings: "ðŸŒ Mga Setting han Pinulungan",
    select_language: "Pili hin Pinulungan:",
    profile_settings: "ðŸ‘¤ Mga Setting han Profile",
    username_label: "Ngaran han Gumaramit:",
    username_immutable: "Diri maililiwat an Username",
    email_label: "Email:",
    update_profile: "ðŸ’¾ I-update an Profile",
    change_password: "ðŸ”’ Liwat hin Password",
    current_password: "Yana nga Password:",
    new_password: "Bag-o nga Password:",
    min_chars: "Minimum nga 4 nga karakter",
    confirm_new_password: "Kumpirmaha an Bag-o nga Password:",
    change_password_btn: "ðŸ”‘ Liwat hin Password",
    session_management: "ðŸšª Pagdumara han Sesyon",
    sign_out_desc: "Pag-gawas ha imo account. Pwede ka bumalik pag-log in bisan san-o.",
    logout_button: "ðŸšª Pag-gawas",
    
    // Camera/Stream
    esp32_cam_live_view: "ðŸ“¹ ESP32-CAM Live View",
    enter_ip_address: "Ilagay an ESP32-CAM IP address ngan i-click an \"Start Stream\" o \"Start Polling\"",
    camera_ip_placeholder: "ESP32-CAM IP (hal., 192.168.1.100)",
    start_stream: "â–¶ï¸ Sugdi an Stream",
    stop: "â¹ï¸ Undangi",
    camera_live_view: "Live View han Camera",
    enter_ip_above: "Ilagay an ESP32-CAM IP address ha taas",
    click_start: "I-click an \"Start Polling\" o \"Start Stream\" para magsugod",
    scanning_leaf: "Gin-susuri an Dahon",
    analyzing_image: "Gin-susuri an ladawan para matukoy an kondisyon han dahon han pechay. Pakihulat la.",
    scanning_in_progress: "Gin-susuri",
    
    // Report Page
    pechay_leaf_detection_report: "Report han Detection han Dahon han Pechay",
    generated_by: "Ginhimo Ni:",
    filters_applied: "Mga Filter nga Gin-aplikar:",
    recent_detections: "ðŸ“‹ Kamakailan nga Mga Detection",
    no_detection_records: "Waray nakitang record han detection.",
    back_to_dashboard: "â¬…ï¸ Bumalik ha Dashboard",
    print_report: "ðŸ–¨ï¸ I-print an Report",
    download_excel: "ðŸ“¥ I-download an Excel",
    
    // Dataset Manager
    dataset_manager_title: "Tagapamahala han Dataset - Pechay Detection System",
    feature_disabled_title: "Naka-disable an Feature",
    feature_disabled_msg: "Ini nga feature diri ginpapagana."
  }
};

// Language Management Functions
function getCurrentLanguage() {
  return localStorage.getItem('pechay_language') || 'en';
}

function setLanguage(lang) {
  localStorage.setItem('pechay_language', lang);
  updateAllTranslations(lang);
}

function translate(key, lang = null) {
  const currentLang = lang || getCurrentLanguage();
  return translations[currentLang] && translations[currentLang][key] 
    ? translations[currentLang][key] 
    : (translations['en'][key] || key);
}

function updateAllTranslations(lang) {
  // Update all elements with data-i18n attribute
  const elements = document.querySelectorAll('[data-i18n]');
  elements.forEach(element => {
    const key = element.getAttribute('data-i18n');
    const translation = translate(key, lang);
    
    // Skip if element is an option inside a select (handled separately)
    if (element.tagName === 'OPTION' && element.parentElement.tagName === 'SELECT') {
      return;
    }
    
    // For elements with children that have data-i18n, update only if no nested data-i18n
    if (element.children.length > 0) {
      const hasNestedI18n = Array.from(element.children).some(child => child.hasAttribute('data-i18n'));
      if (!hasNestedI18n) {
        // Check if element has only text content or simple structure
        const textNodes = Array.from(element.childNodes).filter(node => node.nodeType === Node.TEXT_NODE && node.textContent.trim());
        if (textNodes.length > 0 || element.children.length === 0) {
          // Preserve non-text children (like icons/spans) but update text
          const textContent = element.textContent;
          const newText = translation;
          if (textContent !== newText) {
            // Find text nodes and replace
            const walker = document.createTreeWalker(
              element,
              NodeFilter.SHOW_TEXT,
              null,
              false
            );
            let firstTextNode = null;
            let node;
            while (node = walker.nextNode()) {
              if (node.textContent.trim() && !firstTextNode) {
                firstTextNode = node;
                break;
              }
            }
            if (firstTextNode) {
              firstTextNode.textContent = newText;
              // Remove other text nodes
              const allTextNodes = [];
            } else {
              element.textContent = translation;
            }
          }
        }
      }
    } else {
      element.textContent = translation;
    }
  });
  
  // Update select options
  const selectOptions = document.querySelectorAll('option[data-i18n]');
  selectOptions.forEach(option => {
    const key = option.getAttribute('data-i18n');
    option.textContent = translate(key, lang);
  });
  
  // Update placeholders
  const placeholderElements = document.querySelectorAll('[data-i18n-placeholder]');
  placeholderElements.forEach(element => {
    const key = element.getAttribute('data-i18n-placeholder');
    element.placeholder = translate(key, lang);
  });
  
  // Update title
  const titleElement = document.querySelector('[data-i18n-title]');
  if (titleElement) {
    const titleKey = titleElement.getAttribute('data-i18n-title');
    document.title = translate(titleKey, lang);
  }
  
  // Update HTML lang attribute
  document.documentElement.lang = lang;
  
  // Update language selector value if it exists
  const languageSelect = document.getElementById('languageSelect');
  if (languageSelect) {
    languageSelect.value = lang;
  }
}

// Initialize language on page load
document.addEventListener('DOMContentLoaded', function() {
  const savedLang = getCurrentLanguage();
  updateAllTranslations(savedLang);
  
  // Update language selector if it exists
  const languageSelect = document.getElementById('languageSelect');
  if (languageSelect) {
    languageSelect.value = savedLang;
    languageSelect.addEventListener('change', function() {
      setLanguage(this.value);
    });
  }
});

